bsshag



!python generate_data.py --num_examples 1000000
import pandas as pd
from google import genai
import uuid
import json
import os
import json
import time
from google import genai
from google.genai.types import CreateBatchJobConfig, JobState, HttpOptions
PROJECT_ID = "YOUR_PROJECT_ID"
LOCATION = "us-central1"
model = "gemini-2.0-flash-lite-001"

bucket_name = "YOUR_BUCKET_NAME"
csv_filename = "chat_dataset.csv"
chunk_size = 200 
Define the output schema needed

response_schema=genai.types.Schema(
        type = genai.types.Type.OBJECT,
        properties = {
            "response": genai.types.Schema(
                type = genai.types.Type.ARRAY,
                items = genai.types.Schema(
                    type = genai.types.Type.OBJECT,
                    properties = {
                        "statement_id": genai.types.Schema(
                            type = genai.types.Type.STRING,
                        ),
                        "language": genai.types.Schema(
                            type = genai.types.Type.STRING,
                        ),
                    },
                ),
            ),
        },
    )
Create the payload by chunking sentences into multiple requests

import csv


with open(csv_filename, 'r', newline='', encoding='utf-8') as csvfile:
    reader = csv.DictReader(csvfile)
    user_statements_parts = []
    for row in reader:
        # Extract id and chat_message from the row
        statement_id = row['id']
        chat_message = row['chat_message']
        
        # Format the user statement
        formatted_statement = f"<user statement id={statement_id}>{chat_message}</user statement >"
        user_statements_parts.append(formatted_statement)


chunked_statements = [user_statements_parts[i:i + chunk_size] for i in range(0, len(user_statements_parts), chunk_size)]

prompt = """
You are multilingual expert. You need to respond with the language that the user statement is written in:
"""

os.remove('payload.jsonl')
for chunk in chunked_statements:

    full_prompt = prompt + "\n".join(chunk)
    payload ={"id":str(uuid.uuid4()), "request":{"contents": [{"role": "user", "parts": [{"text": full_prompt}]}], 
                                             "generationConfig": {"responseMimeType":"application/json","responseSchema":response_schema.to_json_dict()}
                                             }}
    
    with open("payload.jsonl", 'a') as file:
        file.write(json.dumps(payload, ensure_ascii=False)+'\n')
Upload the payload to GCS and kick off the batch job

from file_utils import upload_file_to_bucket

upload_file_to_bucket(bucket_name, "payload.jsonl", "payload.jsonl")
client = genai.Client(http_options=HttpOptions(api_version="v1"), vertexai=True, project=PROJECT_ID, location=LOCATION)

output_uri = f"gs://{bucket_name}/output"

# See the documentation: https://googleapis.github.io/python-genai/genai.html#genai.batches.Batches.create
job = client.batches.create(
    model=model,
    # Source link: https://storage.cloud.google.com/cloud-samples-data/batch/prompt_for_batch_gemini_predict.jsonl
    src=f"gs://{bucket_name}/payload.jsonl",
    config=CreateBatchJobConfig(dest=output_uri),
)
print(f"Job name: {job.name}")
print(f"Job state: {job.state}")

# See the documentation: https://googleapis.github.io/python-genai/genai.html#genai.types.BatchJob
completed_states = {
    JobState.JOB_STATE_SUCCEEDED,
    JobState.JOB_STATE_FAILED,
    JobState.JOB_STATE_CANCELLED,
    JobState.JOB_STATE_PAUSED,
}

while job.state not in completed_states:
    time.sleep(30)
    job = client.batches.get(name=job.name)
    print(f"Job state: {job.state}")
Once the job is done, load & process the results

from file_utils import get_latest_folder

latest = get_latest_folder(bucket_name, 'output')
latest_output = f"{latest}predictions.jsonl"
from file_utils import read_jsonl_from_bucket    

result = read_jsonl_from_bucket(bucket_name, latest_output)
i = 0
predictions = []
for res in result:
    try:
        preds = json.loads(res['response']['candidates'][0]['content']['parts'][0]["text"])['response']
        predictions.extend(preds)
    except Exception as e:
        print(e)
    
predictions_df = pd.DataFrame(predictions)
predictions_df = predictions_df.rename(columns={"language":"predicted_language", "statement_id":"id"}).astype(str)

groundtruth_df = pd.read_csv("chat_dataset.csv").astype(str)

merged_df = groundtruth_df.merge(predictions_df, how="left", on="id")
merged_df.head()
We can also get the total number of tokens in/out used from the metadata and calculate accurately the cost of the job

prompt_tokens = 0
output_tokens = 0

input_cost_per_token = 0.075 / 10**6
output_cost_per_token = 0.30 / 10**6

for res in result:
    prompt_tokens += res['response']['usageMetadata']['candidatesTokenCount']
    output_tokens += res['response']['usageMetadata']['promptTokenCount']

total_price = prompt_tokens*input_cost_per_token+output_tokens*output_cost_per_token
print(f"Total cost for {prompt_tokens} input tokens and {output_tokens} output tokens is {total_price}$")
print(f"Total cost with batch api: {total_price/2}$")


print(f"extrapolating to 10M messaged that would mean: {total_price/2 /len(predictions) * 10**7}$")
(optional) Display top languages in the dataset

import matplotlib.pyplot as plt
import seaborn as sns

language_counts_all = merged_df['predicted_language'].value_counts()
top_n = 15

if language_counts_all.empty:
    print("The 'predicted_language' column is empty or contains no data.")
else:
    if top_n and top_n > 0 and top_n < len(language_counts_all):
        language_counts_to_plot = language_counts_all.nlargest(top_n)
        chart_title = f'Top {top_n} Predicted Languages'
    else:
        language_counts_to_plot = language_counts_all
        chart_title = 'Distribution of All Predicted Languages'

    plt.figure(figsize=(12, 7))

    plot = sns.barplot(x=language_counts_to_plot.index, y=language_counts_to_plot.values, palette="viridis", order=language_counts_to_plot.index)

    for bar in plot.patches:
        plot.annotate(format(bar.get_height(), '.0f'), 
                        (bar.get_x() + bar.get_width() / 2., bar.get_height()),
                        ha = 'center', va = 'center',
                        size=10, xytext = (0, 8),
                        textcoords = 'offset points')

    plt.title(chart_title, fontsize=16)
    plt.xlabel('Language', fontsize=14)
    plt.ylabel('Number of Predictions', fontsize=14)
    plt.xticks(rotation=45, ha="right") 
    plt.tight_layout()


.py
import json
import os
from google.cloud import storage


def upload_file_to_bucket(bucket_name, source_file_name, destination_blob_name):    
    storage_client = storage.Client()
    bucket = storage_client.bucket(bucket_name)
    blob = bucket.blob(destination_blob_name)

    blob.upload_from_filename(source_file_name)

    print(
        f"File {os.path.abspath(source_file_name)} uploaded to {destination_blob_name}."
    )

def read_jsonl_from_bucket(bucket_name, blob_name):
    """Reads a JSONL file from a Google Cloud Storage bucket.
    Args:
        bucket_name: The name of the GCS bucket.
        blob_name: The name of the blob (file) in the bucket.
    Returns:
        A list of dictionaries, where each dictionary represents a line in the JSONL file,
        or None if there was an error.
    """
    try:
        storage_client = storage.Client()
        bucket = storage_client.bucket(bucket_name)
        blob = bucket.blob(blob_name)
        
        jsonl_data = []
        with blob.open("r") as f:
            for line in f:
                jsonl_data.append(json.loads(line))
        return jsonl_data
    except Exception as e:
        print(f"An error occurred: {e}")
        return None


def get_latest_folder(bucket_name, prefix):
    """
    Retrieves the latest folder within a specified Google Cloud Storage bucket and prefix,
    sorted alphabetically by folder name.
    Args:
        bucket_name (str): The name of the GCS bucket.
        prefix (str): The prefix (path) within the bucket.
    Returns:
        str: The name of the latest folder, or None if no folders are found.
    """
    storage_client = storage.Client()
    bucket = storage_client.bucket(bucket_name)

    # Ensure the prefix ends with a slash for proper folder matching
    if not prefix.endswith('/'):
        prefix += '/'

    blobs = bucket.list_blobs(prefix=prefix, delimiter='/')

    folders = []
    for page in blobs.pages:
        for prefix_item in page.prefixes:
            folders.append(prefix_item)

    if not folders:
        return None

    latest_folder = sorted(folders)[-1]
    return latest_folder
generate_data.py
import csv
import argparse 

# Predefined dataset (250 examples generated with Gemini 2.5 Pro)

PREDEFINED_EXAMPLES = [
    ["Hello, how are you today?", "English"],
    ["Hola, Â¿cÃ³mo estÃ¡s?", "Spanish"],
    ["Bonjour, comment Ã§a va ?", "French"],
    ["Hallo, wie geht es dir?", "German"],
    ["Ciao, come stai?", "Italian"],
    ["OlÃ¡, como vocÃª estÃ¡?", "Portuguese"],
    ["ÐŸÑ€Ð¸Ð²ÐµÑ‚, ÐºÐ°Ðº Ð´ÐµÐ»Ð°?", "Russian"],
    ["ä½ å¥½ï¼Œä½ ä»Šå¤©æ€Žä¹ˆæ ·ï¼Ÿ", "Chinese (Simplified)"],
    ["ã“ã‚“ã«ã¡ã¯ã€ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ", "Japanese"],
    ["ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ ì–´ë– ì„¸ìš”?", "Korean"],
    ["Merhaba, bugÃ¼n nasÄ±lsÄ±n?", "Turkish"],
    ["Hej, hur mÃ¥r du?", "Swedish"],
    ["Hei, hvordan har du det?", "Norwegian"],
    ["Hallo, hoe gaat het met je?", "Dutch"],
    ["CzeÅ›Ä‡, jak siÄ™ masz?", "Polish"],
    ["Ahoj, jak se mÃ¡Å¡?", "Czech"],
    ["Szia, hogy vagy?", "Hungarian"],
    ["Î“ÎµÎ¹Î± ÏƒÎ¿Ï…, Ï„Î¹ ÎºÎ¬Î½ÎµÎ¹Ï‚;", "Greek"],
    ["×©×œ×•×, ×ž×” ×©×œ×•×ž×š?", "Hebrew"],
    ["Ù…Ø±Ø­Ø¨Ø§ØŒ ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ", "Arabic"],
    ["à¤¨à¤®à¤¸à¥à¤¤à¥‡, à¤†à¤œ à¤†à¤ª à¤•à¥ˆà¤¸à¥‡ à¤¹à¥ˆà¤‚?", "Hindi"],
    [" Ø®ÙˆØ¨ÛŒØŸ Ø³Ù„Ø§Ù…", "Persian (Farsi)"],
    ["Apa kabar hari ini?", "Indonesian"],
    ["Kamusta ka ngayon?", "Tagalog (Filipino)"],
    ["à¸ªà¸šà¸²à¸¢à¸”à¸µà¹„à¸«à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰", "Thai"],
    ["HÃ´m nay báº¡n tháº¿ nÃ o?", "Vietnamese"],
    ["What's up? ðŸ˜„", "English"],
    ["Â¿QuÃ© tal? Todo bien por aquÃ­.", "Spanish"],
    ["Ã‡a roule ? Super et toi ?", "French"],
    ["Alles klar bei dir? ðŸ‘", "German"],
    ["Tutto bene, grazie! E tu?", "Italian"],
    ["BRB, need to grab a coffee â˜•", "English"],
    ["LOL, that's hilarious ðŸ˜‚", "English"],
    ["No problem!", "English"],
    ["Gracias por tu ayuda.", "Spanish"],
    ["Merci beaucoup!", "French"],
    ["Vielen Dank!", "German"],
    ["Grazie mille!", "Italian"],
    ["Muito obrigado!", "Portuguese"],
    ["Ð‘Ð¾Ð»ÑŒÑˆÐ¾Ðµ ÑÐ¿Ð°ÑÐ¸Ð±Ð¾!", "Russian"],
    ["éžå¸¸æ„Ÿè°¢ï¼", "Chinese (Simplified)"],
    ["æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†ï¼", "Japanese"],
    ["ì •ë§ ê³ ë§™ìŠµë‹ˆë‹¤!", "Korean"],
    ["Ã‡ok teÅŸekkÃ¼r ederim!", "Turkish"],
    ["Tack sÃ¥ mycket!", "Swedish"],
    ["Tusen takk!", "Norwegian"],
    ["Hartelijk bedankt!", "Dutch"],
    ["DziÄ™kujÄ™ bardzo!", "Polish"],
    ["DÄ›kuji mnohokrÃ¡t!", "Czech"],
    ["Nagyon kÃ¶szÃ¶nÃ¶m!", "Hungarian"],
    ["Î•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„ÏŽ Ï€Î¿Î»Ï!", "Greek"],
    ["×ª×•×“×” ×¨×‘×”!", "Hebrew"],
    ["Ø´ÙƒØ±Ø§ Ø¬Ø²ÙŠÙ„Ø§!", "Arabic"],
    ["à¤¬à¤¹à¥à¤¤ à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦!", "Hindi"],
    ["Ø®ÛŒÙ„ÛŒ Ù…Ù…Ù†ÙˆÙ†!", "Persian (Farsi)"],
    ["Terima kasih banyak!", "Indonesian"],
    ["Maraming salamat!", "Tagalog (Filipino)"],
    ["à¸‚à¸­à¸šà¸„à¸¸à¸“à¸¡à¸²à¸à¸„à¸£à¸±à¸š/à¸„à¹ˆà¸°", "Thai"],
    ["Cáº£m Æ¡n báº¡n ráº¥t nhiá»u!", "Vietnamese"],
    ["I'm running a bit late, sorry!", "English"],
    ["Llego un poco tarde, lo siento.", "Spanish"],
    ["Je suis un peu en retard, dÃ©solÃ© !", "French"],
    ["Ich bin etwas spÃ¤t dran, tut mir leid!", "German"],
    ["Sono un po' in ritardo, mi dispiace!", "Italian"],
    ["Estou um pouco atrasado, desculpe!", "Portuguese"],
    ["Ð¯ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¾Ð¿Ð°Ð·Ð´Ñ‹Ð²Ð°ÑŽ, Ð¸Ð·Ð²Ð¸Ð½Ð¸Ñ‚Ðµ!", "Russian"],
    ["æˆ‘æœ‰ç‚¹è¿Ÿåˆ°äº†ï¼ŒæŠ±æ­‰ï¼", "Chinese (Simplified)"],
    ["å°‘ã—é…ã‚Œã¾ã™ã€ã™ã¿ã¾ã›ã‚“ï¼", "Japanese"],
    ["ì¡°ê¸ˆ ëŠ¦ì„ ê²ƒ ê°™ì•„ìš”, ì£„ì†¡í•©ë‹ˆë‹¤!", "Korean"],
    ["Biraz geÃ§ kaldÄ±m, Ã¶zÃ¼r dilerim!", "Turkish"],
    ["Jag Ã¤r lite sen, fÃ¶rlÃ¥t!", "Swedish"],
    ["Jeg er litt forsinket, beklager!", "Norwegian"],
    ["Ik ben een beetje laat, sorry!", "Dutch"],
    ["Jestem trochÄ™ spÃ³Åºniony, przepraszam!", "Polish"],
    ["MÃ¡m trochu zpoÅ¾dÄ›nÃ­, omlouvÃ¡m se!", "Czech"],
    ["Kicsit kÃ©sek, bocsÃ¡nat!", "Hungarian"],
    ["ÎˆÏ‡Ï‰ Î±ÏÎ³Î®ÏƒÎµÎ¹ Î»Î¯Î³Î¿, ÏƒÏ…Î³Î³Î½ÏŽÎ¼Î·!", "Greek"],
    ["×× ×™ ×§×¦×ª ×ž××—×¨, ×¡×œ×™×—×”!", "Hebrew"],
    ["Ø£Ù†Ø§ Ù…ØªØ£Ø®Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ØŒ Ø¢Ø³Ù!", "Arabic"],
    ["à¤®à¥à¤à¥‡ à¤¥à¥‹à¤¡à¤¼à¥€ à¤¦à¥‡à¤° à¤¹à¥‹ à¤—à¤ˆ à¤¹à¥ˆ, à¤®à¤¾à¤«à¤¼ à¤•à¤°à¤¨à¤¾!", "Hindi"],
    ["Ù…Ù† Ú©Ù…ÛŒ Ø¯ÛŒØ± Ú©Ø±Ø¯Ù…ØŒ Ø¨Ø¨Ø®Ø´ÛŒØ¯!", "Persian (Farsi)"],
    ["Saya agak terlambat, maaf!", "Indonesian"],
    ["Medyo huli na ako, paumanhin!", "Tagalog (Filipino)"],
    ["à¸‰à¸±à¸™à¸¡à¸²à¸ªà¸²à¸¢à¹„à¸›à¸«à¸™à¹ˆà¸­à¸¢ à¸‚à¸­à¹‚à¸—à¸©à¸”à¹‰à¸§à¸¢à¸™à¸°", "Thai"],
    ["TÃ´i Ä‘áº¿n hÆ¡i muá»™n, xin lá»—i!", "Vietnamese"],
    ["Can you send me the file?", "English"],
    ["Â¿Puedes enviarme el archivo?", "Spanish"],
    ["Peux-tu m'envoyer le fichier ?", "French"],
    ["Kannst du mir die Datei schicken?", "German"],
    ["Puoi inviarmi il file?", "Italian"],
    ["VocÃª pode me enviar o arquivo?", "Portuguese"],
    ["ÐœÐ¾Ð¶ÐµÑˆÑŒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð½Ðµ Ñ„Ð°Ð¹Ð»?", "Russian"],
    ["ä½ èƒ½æŠŠæ–‡ä»¶å‘ç»™æˆ‘å—ï¼Ÿ", "Chinese (Simplified)"],
    ["ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ", "Japanese"],
    ["íŒŒì¼ ì¢€ ë³´ë‚´ì¤„ ìˆ˜ ìžˆì–´ìš”?", "Korean"],
    ["DosyayÄ± bana gÃ¶nderebilir misin?", "Turkish"],
    ["Kan du skicka filen till mig?", "Swedish"],
    ["Kan du sende meg filen?", "Norwegian"],
    ["Kun je me het bestand sturen?", "Dutch"],
    ["Czy moÅ¼esz wysÅ‚aÄ‡ mi plik?", "Polish"],
    ["MÅ¯Å¾eÅ¡ mi poslat ten soubor?", "Czech"],
    ["El tudnÃ¡d kÃ¼ldeni a fÃ¡jlt?", "Hungarian"],
    ["ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î¼Î¿Ï… ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹Ï‚ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿;", "Greek"],
    ["××ª×” ×™×›×•×œ ×œ×©×œ×•×— ×œ×™ ××ª ×”×§×•×‘×¥?", "Hebrew"],
    ["Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ù„ÙŠØŸ", "Arabic"],
    ["à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤®à¥à¤à¥‡ à¤«à¤¼à¤¾à¤‡à¤² à¤­à¥‡à¤œ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚?", "Hindi"],
    ["Ù…ÛŒ ØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ù† Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ØŸ", "Persian (Farsi)"],
    ["Bisakah Anda mengirimkan saya filenya?", "Indonesian"],
    ["Maaari mo bang ipadala sa akin ang file?", "Tagalog (Filipino)"],
    ["à¸„à¸¸à¸“à¸Šà¹ˆà¸§à¸¢à¸ªà¹ˆà¸‡à¹„à¸Ÿà¸¥à¹Œà¸¡à¸²à¹ƒà¸«à¹‰à¸‰à¸±à¸™à¹„à¸”à¹‰à¹„à¸«à¸¡", "Thai"],
    ["Báº¡n cÃ³ thá»ƒ gá»­i cho tÃ´i táº­p tin Ä‘Æ°á»£c khÃ´ng?", "Vietnamese"],
    ["That's awesome! ðŸš€", "English"],
    ["Â¡QuÃ© genial! ðŸŽ‰", "Spanish"],
    ["C'est gÃ©nial ! ðŸŽŠ", "French"],
    ["Das ist fantastisch! ðŸŒŸ", "German"],
    ["Ãˆ fantastico! âœ¨", "Italian"],
    ["Is this the correct `config.json`?", "English"],
    ["Warte mal, ich check das kurz.", "German"],
    ["Un momento, por favor.", "Spanish"],
    ["Just a sec, I'll check.", "English"],
    ["ÐœÑ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð²ÑÑ‚Ñ€ÐµÑ‚Ð¸Ñ‚ÑŒÑÑ Ð² 3 Ñ‡Ð°ÑÐ° Ð´Ð½Ñ.", "Russian"],
    ["ã“ã®ãƒã‚°ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", "Japanese"],
    ["ì´ ë²„ê·¸ë¥¼ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.", "Korean"],
    ["Bu hatayÄ± dÃ¼zeltmemiz gerekiyor.", "Turkish"],
    ["Vi mÃ¥ste fixa den hÃ¤r buggen.", "Swedish"],
    ["Vi mÃ¥ fikse denne feilen.", "Norwegian"],
    ["We moeten deze bug repareren.", "Dutch"],
    ["Musimy naprawiÄ‡ ten bÅ‚Ä…d.", "Polish"],
    ["MusÃ­me opravit tuto chybu.", "Czech"],
    ["Ki kell javÃ­tanunk ezt a hibÃ¡t.", "Hungarian"],
    ["Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎ¿Ï…Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏ†Î¬Î»Î¼Î±.", "Greek"],
    ["×× ×—× ×• ×¦×¨×™×›×™× ×œ×ª×§×Ÿ ××ª ×”×‘××’ ×”×–×”.", "Hebrew"],
    ["ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙ†Ø§ Ø¥ØµÙ„Ø§Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø®Ø·Ø£.", "Arabic"],
    ["à¤¹à¤®à¥‡à¤‚ à¤‡à¤¸ à¤¬à¤— à¤•à¥‹ à¤ à¥€à¤• à¤•à¤°à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾à¥¤", "Hindi"],
    ["Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ø§Ø´Ú©Ø§Ù„ Ø±Ø§ Ø¨Ø±Ø·Ø±Ù Ú©Ù†ÛŒÙ….", "Persian (Farsi)"],
    ["Kita harus memperbaiki bug ini.", "Indonesian"],
    ["Kailangan nating ayusin ang bug na ito.", "Tagalog (Filipino)"],
    ["à¹€à¸£à¸²à¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸šà¸à¸žà¸£à¹ˆà¸­à¸‡à¸™à¸µà¹‰", "Thai"],
    ["ChÃºng ta cáº§n sá»­a lá»—i nÃ y.", "Vietnamese"],
    ["See you later! ðŸ‘‹", "English"],
    ["Â¡Hasta luego! ðŸ‘‹", "Spanish"],
    ["Ã€ plus tard ! ðŸ‘‹", "French"],
    ["Bis spÃ¤ter! ðŸ‘‹", "German"],
    ["A dopo! ðŸ‘‹", "Italian"],
    ["AtÃ© logo! ðŸ‘‹", "Portuguese"],
    ["Ð£Ð²Ð¸Ð´Ð¸Ð¼ÑÑ! ðŸ‘‹", "Russian"],
    ["å†è§ï¼ðŸ‘‹", "Chinese (Simplified)"],
    ["ã¾ãŸã­ï¼ðŸ‘‹", "Japanese"],
    ["ë‚˜ì¤‘ì— ë´ìš”! ðŸ‘‹", "Korean"],
    ["GÃ¶rÃ¼ÅŸÃ¼rÃ¼z! ðŸ‘‹", "Turkish"],
    ["Okay, sounds good.", "English"],
    ["Vale, me parece bien.", "Spanish"],
    ["D'accord, Ã§a me va.", "French"],
    ["Okay, das klingt gut.", "German"],
    ["Va bene, mi sembra buono.", "Italian"],
    ["Ok, parece bom.", "Portuguese"],
    ["Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾, Ð·Ð²ÑƒÑ‡Ð¸Ñ‚ Ð½ÐµÐ¿Ð»Ð¾Ñ…Ð¾.", "Russian"],
    ["å¥½çš„ï¼Œå¬èµ·æ¥ä¸é”™ã€‚", "Chinese (Simplified)"],
    ["ã‚ã‹ã£ãŸã€è‰¯ã•ãã†ã ã­ã€‚", "Japanese"],
    ["ì•Œê² ì–´ìš”, ì¢‹ì€ ê²ƒ ê°™ì•„ìš”.", "Korean"],
    ["Tamam, kulaÄŸa hoÅŸ geliyor.", "Turkish"],
    ["Okej, det lÃ¥ter bra.", "Swedish"],
    ["Ok, det hÃ¸res bra ut.", "Norwegian"],
    ["OkÃ©, dat klinkt goed.", "Dutch"],
    ["Okej, brzmi dobrze.", "Polish"],
    ["DobÅ™e, to znÃ­ dobÅ™e.", "Czech"],
    ["Rendben, jÃ³l hangzik.", "Hungarian"],
    ["Î•Î½Ï„Î¬Î¾ÎµÎ¹, Î±ÎºÎ¿ÏÎ³ÎµÏ„Î±Î¹ ÎºÎ±Î»ÏŒ.", "Greek"],
    ["×‘×¡×“×¨, × ×©×ž×¢ ×˜×•×‘.", "Hebrew"],
    ["Ø­Ø³Ù†Ù‹Ø§ØŒ Ù‡Ø°Ø§ ÙŠØ¨Ø¯Ùˆ Ø¬ÙŠØ¯Ù‹Ø§.", "Arabic"],
    ["à¤ à¥€à¤• à¤¹à¥ˆ, à¤¸à¥à¤¨à¤¨à¥‡ à¤®à¥‡à¤‚ à¤…à¤šà¥à¤›à¤¾ à¤²à¤— à¤°à¤¹à¤¾ à¤¹à¥ˆà¥¤", "Hindi"],
    ["Ø¨Ø§Ø´Ù‡ØŒ Ø®ÙˆØ¨ Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒØ±Ø³Ù‡.", "Persian (Farsi)"],
    ["Oke, kedengarannya bagus.", "Indonesian"],
    ["Sige, mukhang maganda iyan.", "Tagalog (Filipino)"],
    ["à¹‚à¸­à¹€à¸„ à¸Ÿà¸±à¸‡à¸”à¸¹à¸”à¸µà¸™à¸°", "Thai"],
    ["ÄÆ°á»£c rá»“i, nghe cÃ³ váº» á»•n.", "Vietnamese"],
    ["What time is the meeting? ðŸ•’", "English"],
    ["Â¿A quÃ© hora es la reuniÃ³n? ðŸ•’", "Spanish"],
    ["Ã€ quelle heure est la rÃ©union ? ðŸ•’", "French"],
    ["Um wie viel Uhr ist das Treffen? ðŸ•’", "German"],
    ["A che ora Ã¨ la riunione? ðŸ•’", "Italian"],
    ["A que horas Ã© a reuniÃ£o? ðŸ•’", "Portuguese"],
    ["Ð’Ð¾ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°? ðŸ•’", "Russian"],
    ["ä¼šè®®å‡ ç‚¹å¼€å§‹ï¼ŸðŸ•’", "Chinese (Simplified)"],
    ["ä¼šè­°ã¯ä½•æ™‚ã§ã™ã‹ï¼ŸðŸ•’", "Japanese"],
    ["íšŒì˜ëŠ” ëª‡ ì‹œì˜ˆìš”? ðŸ•’", "Korean"],
    ["ToplantÄ± saat kaÃ§ta? ðŸ•’", "Turkish"],
    ["NÃ¤r Ã¤r mÃ¶tet? ðŸ•’", "Swedish"],
    ["NÃ¥r er mÃ¸tet? ðŸ•’", "Norwegian"],
    ["Hoe laat is de vergadering? ðŸ•’", "Dutch"],
    ["O ktÃ³rej godzinie jest spotkanie? ðŸ•’", "Polish"],
    ["V kolik hodin je schÅ¯zka? ðŸ•’", "Czech"],
    ["Mikor van a talÃ¡lkozÃ³? ðŸ•’", "Hungarian"],
    ["Î¤Î¹ ÏŽÏÎ± ÎµÎ¯Î½Î±Î¹ Î· ÏƒÏ…Î½Î¬Î½Ï„Î·ÏƒÎ·; ðŸ•’", "Greek"],
    ["×‘××™×–×• ×©×¢×” ×”×¤×’×™×©×”? ðŸ•’", "Hebrew"],
    ["ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ØŸ ðŸ•’", "Arabic"],
    ["à¤®à¥€à¤Ÿà¤¿à¤‚à¤— à¤•à¤¿à¤¤à¤¨à¥‡ à¤¬à¤œà¥‡ à¤¹à¥ˆ? ðŸ•’", "Hindi"],
    ["Ø¬Ù„Ø³Ù‡ Ø³Ø§Ø¹Øª Ú†Ù†Ø¯ Ø§Ø³ØªØŸ ðŸ•’", "Persian (Farsi)"],
    ["Jam berapa pertemuannya? ðŸ•’", "Indonesian"],
    ["Anong oras ang pulong? ðŸ•’", "Tagalog (Filipino)"],
    ["à¸›à¸£à¸°à¸Šà¸¸à¸¡à¸à¸µà¹ˆà¹‚à¸¡à¸‡ ðŸ•’", "Thai"],
    ["Máº¥y giá» há»p váº­y? ðŸ•’", "Vietnamese"],
    ["Let's start the project. ðŸ’ª", "English"],
    ["Empecemos el proyecto. ðŸ’ª", "Spanish"],
    ["CommenÃ§ons le projet. ðŸ’ª", "French"],
    ["Fangen wir mit dem Projekt an. ðŸ’ª", "German"],
    ["Iniziamo il progetto. ðŸ’ª", "Italian"],
    ["Ð”Ð°Ð²Ð°Ð¹ Ð½Ð°Ñ‡Ð½ÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚. ðŸ’ª", "Russian"],
    ["ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚ðŸ’ª", "Japanese"],
    ["í”„ë¡œì íŠ¸ë¥¼ ì‹œìž‘í•©ì‹œë‹¤. ðŸ’ª", "Korean"],
    ["Haydi projeye baÅŸlayalÄ±m. ðŸ’ª", "Turkish"],
    ["My favorite color is blue. What's yours?", "English"],
    ["Mi color favorito es el azul. Â¿CuÃ¡l es el tuyo?", "Spanish"],
    ["Ma couleur prÃ©fÃ©rÃ©e est le bleu. Et la tienne ?", "French"],
    ["Meine Lieblingsfarbe ist Blau. Was ist deine?", "German"],
    ["Il mio colore preferito Ã¨ il blu. Qual Ã¨ il tuo?", "Italian"],
    ["Minha cor favorita Ã© azul. Qual Ã© a sua?", "Portuguese"],
    ["ÐœÐ¾Ð¹ Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ð¹ Ñ†Ð²ÐµÑ‚ - ÑÐ¸Ð½Ð¸Ð¹. Ð Ñ‚Ð²Ð¾Ð¹?", "Russian"],
    ["æˆ‘æœ€å–œæ¬¢çš„é¢œè‰²æ˜¯è“è‰²ã€‚ä½ çš„æ˜¯ä»€ä¹ˆï¼Ÿ", "Chinese (Simplified)"],
    ["ç§ã®å¥½ããªè‰²ã¯é’ã§ã™ã€‚ã‚ãªãŸã®ã¯ä½•è‰²ã§ã™ã‹ï¼Ÿ", "Japanese"],
    ["ì œê°€ ê°€ìž¥ ì¢‹ì•„í•˜ëŠ” ìƒ‰ì€ íŒŒëž€ìƒ‰ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ìš”?", "Korean"],
    ["En sevdiÄŸim renk mavi. Seninki ne?", "Turkish"],
    ["Min favoritfÃ¤rg Ã¤r blÃ¥. Vilken Ã¤r din?", "Swedish"],
    ["Min favorittfarge er blÃ¥. Hva er din?", "Norwegian"],
    ["Mijn lievelingskleur is blauw. Wat is die van jou?", "Dutch"],
    ["MÃ³j ulubiony kolor to niebieski. A jaki jest twÃ³j?", "Polish"],
    ["Moje oblÃ­benÃ¡ barva je modrÃ¡. JakÃ¡ je tvoje?", "Czech"],
    ["A kedvenc szÃ­nem a kÃ©k. Ã‰s a tiÃ©d?", "Hungarian"],
    ["Î¤Î¿ Î±Î³Î±Ï€Î·Î¼Î­Î½Î¿ Î¼Î¿Ï… Ï‡ÏÏŽÎ¼Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î¼Ï€Î»Îµ. Î Î¿Î¹Î¿ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï…;", "Greek"],
    ["×”×¦×‘×¢ ×”××”×•×‘ ×¢×œ×™×™ ×”×•× ×›×—×•×œ. ×ž×” ×©×œ×š?", "Hebrew"],
    ["Ù„ÙˆÙ†ÙŠ Ø§Ù„Ù…ÙØ¶Ù„ Ù‡Ùˆ Ø§Ù„Ø£Ø²Ø±Ù‚. Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ†Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ØŸ", "Arabic"],
    ["à¤®à¥‡à¤°à¤¾ à¤ªà¤¸à¤‚à¤¦à¥€à¤¦à¤¾ à¤°à¤‚à¤— à¤¨à¥€à¤²à¤¾ à¤¹à¥ˆà¥¤ à¤†à¤ªà¤•à¤¾ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?", "Hindi"],
    ["Ø±Ù†Ú¯ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡ Ù…Ù† Ø¢Ø¨ÛŒ Ø§Ø³Øª. Ù…Ø§Ù„ Ø´Ù…Ø§ Ú†ÛŒØ³ØªØŸ", "Persian (Farsi)"],
    ["Warna favorit saya adalah biru. Apa warna favoritmu?", "Indonesian"],
    ["Ang paborito kong kulay ay asul. Ano ang sa iyo?", "Tagalog (Filipino)"],
    ["à¸ªà¸µà¸—à¸µà¹ˆà¸‰à¸±à¸™à¸Šà¸­à¸šà¸„à¸·à¸­à¸ªà¸µà¸™à¹‰à¸³à¹€à¸‡à¸´à¸™ à¸„à¸¸à¸“à¸¥à¹ˆà¸°à¸Šà¸­à¸šà¸ªà¸µà¸­à¸°à¹„à¸£", "Thai"],
    ["MÃ u yÃªu thÃ­ch cá»§a tÃ´i lÃ  mÃ u xanh dÆ°Æ¡ng. CÃ²n báº¡n thÃ¬ sao?", "Vietnamese"],
    ["I need help with this code: `print('Hello World')`", "English"],
    ["Este es un mensaje en espaÃ±ol con algunos tÃ©rminos en inglÃ©s como 'debug' o 'commit'.", "Spanish"],
    ["C'est un message en franÃ§ais avec des mots anglais : 'weekend', 'cool'.", "French"],
    ["Das ist eine deutsche Nachricht, aber ich sage manchmal 'OK'.", "German"],
    ["Questo Ã¨ un messaggio in italiano, ma a volte uso 'meeting'.", "Italian"],
    ["Ð­Ñ‚Ð¾ Ñ€ÑƒÑÑÐºÐ¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ð½Ð¾ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽ ÑÐ»Ð¾Ð²Ð¾ 'online'.", "Russian"],
    ["è¿™æ˜¯ä¸€ä¸ªä¸­æ–‡ä¿¡æ¯ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¼šè¯´ 'bye bye'ã€‚", "Chinese (Simplified)"],
    ["ã“ã‚Œã¯æ—¥æœ¬èªžã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ãŒã€ã€ŒOKã€ã¨è¨€ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚", "Japanese"],
    ["ì´ê²ƒì€ í•œêµ­ì–´ ë©”ì‹œì§€ì´ì§€ë§Œ 'OK'ë¼ê³  ë§í•˜ê¸°ë„ í•©ë‹ˆë‹¤.", "Korean"],
    ["Bu TÃ¼rkÃ§e bir mesaj ama bazen 'check-in' diyoruz.", "Turkish"],
    ["Could you please review my PR?", "English"],
    ["The API returned a 404 error.", "English"],
    ["Let's sync up later today. ðŸ¤", "English"]
]

NUM_PREDEFINED = len(PREDEFINED_EXAMPLES)

def generate_csv_data(num_examples_to_generate):
    """
    Generates the data for the CSV file.
    Args:
        num_examples_to_generate (int): The total number of examples to generate.
    Returns:
        list: A list of lists, where each inner list is a row for the CSV.
    """
    data_to_write = []
    if num_examples_to_generate <= 0:
        return data_to_write # Return empty list if 0 or negative examples requested

    for i in range(num_examples_to_generate):
        current_id = i + 1 # IDs are 1-based
        
        # Select an example from the predefined list
        # Use modulo operator to loop through PREDEFINED_EXAMPLES if num_examples_to_generate > NUM_PREDEFINED
        example_index = i % NUM_PREDEFINED
        
        chat_message = PREDEFINED_EXAMPLES[example_index][0]
        language = PREDEFINED_EXAMPLES[example_index][1]
        
        data_to_write.append([current_id, chat_message, language])
        
    return data_to_write

def main():
    # --- Argument Parsing ---
    parser = argparse.ArgumentParser(
        description="Generate a CSV dataset of chat messages for language detection.",
        formatter_class=argparse.ArgumentDefaultsHelpFormatter 
    )
    parser.add_argument(
        "--num_examples",
        "-n",
        type=int,
        default=NUM_PREDEFINED, 
        help="Total number of chat message examples to generate in the CSV."
    )
    parser.add_argument(
        "--output_file",
        "-o",
        type=str,
        default="chat_dataset.csv",
        help="Name of the CSV file to be created."
    )
    args = parser.parse_args()

    num_to_generate = args.num_examples
    output_filename = args.output_file

    if num_to_generate <= 0:
        print("Number of examples must be a positive integer. Exiting.")
        return

    # --- Generate Data ---
    print(f"Generating {num_to_generate} chat message examples...")
    generated_data = generate_csv_data(num_to_generate)

    # --- Write to CSV ---
    header = ['id', 'chat_message', 'language']
    try:
        with open(output_filename, 'w', newline='', encoding='utf-8') as csvfile:
            csvwriter = csv.writer(csvfile)
            csvwriter.writerow(header) 
            csvwriter.writerows(generated_data) 
        print(f"Successfully created '{output_filename}' with {len(generated_data)} records.")
    except IOError:
        print(f"Error: Could not write to file '{output_filename}'. Check permissions or path.")
    except Exception as e:
        print(f"An unexpected error occurred during CSV writing: {e}")

if __name__ == "__main__":
    if len(PREDEFINED_EXAMPLES) != 250:
        print(f"Warning: The PREDEFINED_EXAMPLES list currently has {len(PREDEFINED_EXAMPLES)} entries.")
        print("For the intended looping behavior and diversity, it should contain 250 unique examples.")
        print("The script will still work, but looping will occur over the available examples.")
    NUM_PREDEFINED = len(PREDEFINED_EXAMPLES) # Update NUM_PREDEFINED based on actual list length for safety

    main()

